{
	"project": "Imanisa Finance - Migration Next.js",
	"mode": "feature",
	"branchName": "ralph/migration-nextjs",
	"baseBranch": "main",
	"description": "Migration complète de SvelteKit + Drizzle + SQLite vers Next.js 15 + Prisma + PostgreSQL + shadcn/ui. Stack: Biome, Vitest, Testcontainers, MSW, ts-rest, Zod. Déployable sur Vercel (gratuit) avec Supabase.",
	"githubRepo": "imanisa-finance/imanisa-finance",
	"plugins": {
		"recommended": ["typescript-lsp", "commit-commands", "frontend-design"],
		"optional": ["security-guidance"]
	},
	"stack": {
		"framework": "Next.js 15 (App Router, Turbopack)",
		"ui": "shadcn/ui + Tailwind CSS v4 + Recharts",
		"orm": "Prisma + PostgreSQL (Supabase)",
		"auth": "Better Auth avec Google OAuth (whitelist 2 emails)",
		"validation": "Zod (client + server)",
		"api": "ts-rest (contrats type-safe)",
		"linting": "Biome (remplace ESLint + Prettier)",
		"testing": {
			"unit": "Vitest + Testing Library (couche domain 90%+ coverage)",
			"components": "React Testing Library (@testing-library/react + user-event)",
			"integration": "Testcontainers PostgreSQL + ts-rest endpoints",
			"mocking": "MSW (Mock Service Worker) pour APIs externes",
			"e2e": "Playwright (parcours utilisateur complets)"
		},
		"testing_strategy": {
			"domain": "Unit tests purs, 90%+ coverage obligatoire. Tester entities, value objects, validations.",
			"api": "Tests d'intégration avec vraie DB (Testcontainers). CRUD + erreurs + queries complexes.",
			"components": "Tests React Testing Library pour composants critiques (navigation, tables, forms).",
			"e2e": "Playwright pour parcours complets: auth, import CSV, navigation, CRUD operations."
		},
		"ci_cd": "GitHub Actions + Codecov + Vercel"
	},
	"instructions": {
		"quality": "OBLIGATOIRE avant chaque passes:true: 1) npm run check (biome lint+format), 2) npm run build (succès), 3) npx tsc --noEmit (0 erreurs). Si un check échoue, corriger avant de continuer.",
		"parallel": "Stories parallélisables par groupe: [US-010,US-011,US-012,US-013], [US-021,US-022,US-023,US-024], [US-050,US-060,US-070,US-080,US-090,US-100,US-110]",
		"ui": "Design iOS 26 / Apple Liquid Glass: glassmorphism (backdrop-blur, bg-opacity), gradients subtils, blobs animés en background, couleurs vives mais harmonieuses. Interface PURE/SIMPLE/PROPRE pour lecture rapide des données financières. Mobile-first. Touch targets ≥44px. Respecter prefers-reduced-motion.",
		"design_system": {
			"aesthetic": "iOS 26 Liquid Glass - moderne, épuré, premium",
			"effects": [
				"backdrop-blur-xl",
				"bg-gradient-to-br",
				"animated blobs",
				"subtle shadows",
				"glass cards"
			],
			"colors": "Palette vibrante mais élégante: teintes de bleu/violet pour le dark mode, pastels lumineux pour le light mode. Vert pour gains, rouge pour pertes.",
			"typography": "SF Pro / Inter - grande lisibilité, hiérarchie claire",
			"data_viz": "KPIs ultra-lisibles en un clin d'œil, chiffres gros et contrastés, icônes expressives",
			"animations": "Transitions fluides (300ms ease), micro-interactions au hover/tap, pas de surcharge"
		},
		"schema": "Ne créer QUE les tables utilisées par l'app. Tables essentielles: users, owners, banks, accounts, transactions, categories, category_rules, transaction_categories, entities, entity_shares, re_properties, property_ownership, re_loans, loan_responsibility, investment_sources, investment_positions. Supprimer les tables legacy non utilisées.",
		"auth": "WHITELIST STRICTE: Seuls 2 emails Google autorisés (Mathieu + Ninon). Tout autre email = rejet à la connexion."
	},
	"userStories": [
		{
			"id": "US-000",
			"title": "Commit et tag version SvelteKit",
			"description": "En tant que développeur, je veux sauvegarder l'état actuel du projet SvelteKit avant migration",
			"acceptanceCriteria": [
				"git add -A && git commit",
				"git tag v1.0-sveltekit",
				"git push origin main --tags"
			],
			"files": [],
			"dependsOn": [],
			"priority": 1,
			"passes": false,
			"notes": "OBLIGATOIRE avant toute migration. Permet rollback si nécessaire."
		},
		{
			"id": "US-001",
			"title": "Setup Next.js 15 + Biome + Tailwind",
			"description": "En tant que développeur, je veux initialiser le projet Next.js 15 avec Biome comme linter/formatter",
			"acceptanceCriteria": [
				"npx create-next-app@latest . --typescript --tailwind --app --src-dir --turbopack (sans --eslint)",
				"npm install -D @biomejs/biome",
				"npx biome init → crée biome.json",
				"Configurer biome.json avec domains react + next recommended",
				"Supprimer .eslintrc si présent",
				"Scripts package.json: check (biome check), format (biome format --write), lint (biome lint)",
				"Structure app/ avec layout.tsx racine créée",
				"Tailwind CSS configuré avec darkMode: 'class'",
				"TypeScript strict mode dans tsconfig.json",
				"npm run check passe (0 erreurs)",
				"npm run build passe sans erreur"
			],
			"files": [
				"package.json",
				"tsconfig.json",
				"biome.json",
				"tailwind.config.ts",
				"app/layout.tsx",
				"next.config.ts"
			],
			"dependsOn": ["US-000"],
			"priority": 2,
			"passes": false,
			"notes": "Biome remplace ESLint + Prettier. 10-25x plus rapide."
		},
		{
			"id": "US-002",
			"title": "Configuration shadcn/ui",
			"description": "En tant que développeur, je veux configurer shadcn/ui comme design system",
			"acceptanceCriteria": [
				"npx shadcn@latest init (style: new-york, base color: zinc, CSS variables: yes)",
				"Composants installés: button, card, input, select, dialog, sheet, dropdown-menu, table, command, form",
				"Theme dark/light avec next-themes",
				"src/components/ui/ contient tous les composants",
				"components.json configuré"
			],
			"files": [
				"components.json",
				"src/components/ui/",
				"src/lib/utils.ts",
				"src/components/theme-provider.tsx"
			],
			"dependsOn": ["US-001"],
			"priority": 3,
			"passes": false,
			"notes": "Installer aussi les dépendances: lucide-react, class-variance-authority, clsx, tailwind-merge"
		},
		{
			"id": "US-002B",
			"title": "Setup Zod + ts-rest",
			"description": "En tant que développeur, je veux configurer Zod pour validation et ts-rest pour les contrats API",
			"acceptanceCriteria": [
				"npm install zod @ts-rest/core @ts-rest/next @ts-rest/react-query",
				"Créer src/contracts/index.ts avec contrat API principal",
				"Définir les routes: /api/accounts, /api/transactions, /api/budget, /api/investments, /api/properties",
				"Schémas Zod pour chaque entité (Account, Transaction, Category, etc.)",
				"Export types inférés depuis les schémas Zod",
				"npm run check passe"
			],
			"files": ["src/contracts/", "src/schemas/"],
			"dependsOn": ["US-001"],
			"priority": 3,
			"passes": false,
			"notes": "ts-rest = type-safety end-to-end sans code generation. Zod = validation partagée client/server."
		},
		{
			"id": "US-002C",
			"title": "Setup Vitest + Testing Library + MSW",
			"description": "En tant que développeur, je veux configurer l'environnement de tests unitaires",
			"acceptanceCriteria": [
				"npm install -D vitest @vitejs/plugin-react jsdom @testing-library/react @testing-library/dom vite-tsconfig-paths",
				"npm install -D msw --save-dev && npx msw init ./public",
				"Créer vitest.config.mts avec plugins react + tsconfigPaths, environment jsdom",
				"Créer src/tests/setup.ts pour initialisation MSW",
				"Créer src/mocks/handlers.ts avec mocks API de base",
				"Créer src/mocks/browser.ts et src/mocks/server.ts",
				"Scripts package.json: test (vitest), test:ui (vitest --ui), test:coverage (vitest --coverage)",
				"Premier test src/components/ui/button.test.tsx passe",
				"npm run test passe"
			],
			"files": ["vitest.config.mts", "src/tests/setup.ts", "src/mocks/", "package.json"],
			"dependsOn": ["US-001"],
			"priority": 3,
			"passes": false,
			"notes": "MSW pour mocker les API en tests. Vitest 4x plus rapide que Jest."
		},
		{
			"id": "US-002D",
			"title": "Setup Testcontainers PostgreSQL",
			"description": "En tant que développeur, je veux configurer Testcontainers pour les tests d'intégration",
			"acceptanceCriteria": [
				"npm install -D @testcontainers/postgresql testcontainers",
				"Créer src/tests/integration/setup.ts avec PostgreSQLContainer",
				"Helper createTestDatabase() qui démarre container + applique migrations Prisma",
				"Helper cleanupTestDatabase() pour teardown",
				"Créer src/tests/integration/repositories/account.test.ts comme exemple",
				"Test d'intégration passe avec vraie DB PostgreSQL en container",
				"npm run test:integration passe"
			],
			"files": ["src/tests/integration/", "package.json"],
			"dependsOn": ["US-002C", "US-003"],
			"priority": 8,
			"passes": false,
			"notes": "Testcontainers = vraie DB PostgreSQL isolée pour chaque test. Requires Docker."
		},
		{
			"id": "US-003",
			"title": "Configuration Prisma + Supabase",
			"description": "En tant que développeur, je veux configurer Prisma avec PostgreSQL Supabase",
			"acceptanceCriteria": [
				"npm install prisma @prisma/client",
				"npx prisma init --datasource-provider postgresql",
				"DATABASE_URL configuré dans .env.example (format Supabase)",
				"src/lib/prisma.ts avec singleton client (Edge compatible)",
				"npx prisma generate fonctionne"
			],
			"files": ["prisma/schema.prisma", "src/lib/prisma.ts", ".env.example", ".env.local"],
			"dependsOn": ["US-001"],
			"priority": 3,
			"passes": false,
			"notes": "Créer projet Supabase gratuit. URL format: postgresql://postgres:[PASSWORD]@db.[PROJECT].supabase.co:5432/postgres"
		},
		{
			"id": "US-010",
			"title": "Schéma Prisma - Core (Owner, User, Bank, Account, Transaction)",
			"description": "En tant que développeur, je veux définir les modèles core dans Prisma",
			"acceptanceCriteria": [
				"Model Owner: id, name, type (enum PERSON/JOINT/SCI), createdAt",
				"Model User: id, ownerId, email, name, avatarUrl, createdAt",
				"Model Bank: id, userId, name, template, createdAt",
				"Model Account: id, bankId, ownerId, name, accountNumber, type, assetCategory, balance, currency, timestamps",
				"Model Transaction: id, accountId, type, amount, currency, description, date, category, importedAt + indexes",
				"Relations définies correctement",
				"npx prisma validate passe"
			],
			"files": ["prisma/schema.prisma"],
			"dependsOn": ["US-003"],
			"priority": 4,
			"passes": false,
			"notes": "Convertir sqliteTable Drizzle → model Prisma. Text → String, real → Float"
		},
		{
			"id": "US-011",
			"title": "Schéma Prisma - Budget (Category, Rule, TransactionCategory)",
			"description": "En tant que développeur, je veux définir les modèles budget dans Prisma",
			"acceptanceCriteria": [
				"Model Category: id, name, parentId (self-reference), icon, color, children relation",
				"Model CategoryRule: id, categoryId, pattern, priority, sourceFilter, isActive",
				"Model TransactionCategory: transactionId (PK), categoryId, source (enum BANK/AUTO/MANUAL), confidence",
				"Relations Transaction → TransactionCategory → Category",
				"npx prisma validate passe"
			],
			"files": ["prisma/schema.prisma"],
			"dependsOn": ["US-010"],
			"priority": 5,
			"passes": false,
			"notes": "Self-reference: Category has parent Category"
		},
		{
			"id": "US-012",
			"title": "Schéma Prisma - Immobilier (Entity, Property, Loan)",
			"description": "En tant que développeur, je veux définir les modèles immobilier dans Prisma",
			"acceptanceCriteria": [
				"Model Entity: id, name, type (enum PERSON/SCI/JOINT), email, color, legalName, siren, etc.",
				"Model EntityShare: id, sciId, holderId, sharesCount, percentage",
				"Model ReProperty: id, name, type, category, address, surface, rooms, DPE, purchase info, rental info, charges",
				"Model PropertyOwnership: id, propertyId, entityId, percentage, acquisitionDate/Type",
				"Model ReLoan: id, name, propertyId, bankName, principalAmount, rate, duration, monthly, insurance, balance",
				"Model LoanResponsibility: id, loanId, entityId, percentage",
				"Model PropertyCharge: id, propertyId, type, name, amount, frequency",
				"Toutes les relations many-to-many configurées",
				"npx prisma validate passe"
			],
			"files": ["prisma/schema.prisma"],
			"dependsOn": ["US-010"],
			"priority": 5,
			"passes": false,
			"notes": "Module le plus complexe avec ownership partagé"
		},
		{
			"id": "US-013",
			"title": "Schéma Prisma - Investissements",
			"description": "En tant que développeur, je veux définir les modèles investissements dans Prisma",
			"acceptanceCriteria": [
				"Model InvestmentSource: id, name, type (enum PEA/ASSURANCE_VIE/CRYPTO/CTO), ownerEntityId, url, format, parserKey",
				"Model InvestmentPosition: id, sourceId, symbol, isin, quantity, avgBuyPrice, currentPrice, currentValue, gainLoss",
				"Model InvestmentTransaction: id, sourceId, date, symbol, type (BUY/SELL), quantity, pricePerUnit, totalAmount, fee",
				"Model Position (legacy): id, accountId, name, isin, ticker, assetType, quantity, pru, currentPrice",
				"Model PriceHistory: id, ticker, date, price, source",
				"npx prisma validate passe"
			],
			"files": ["prisma/schema.prisma"],
			"dependsOn": ["US-010"],
			"priority": 5,
			"passes": false,
			"notes": "Deux systèmes: enhanced (InvestmentSource/Position) et legacy (Position)"
		},
		{
			"id": "US-014",
			"title": "Schéma Prisma - DataSource + finalisation",
			"description": "En tant que développeur, je veux finaliser le schéma Prisma avec les tables essentielles",
			"acceptanceCriteria": [
				"Model DataSource: id, name, type, ownerEntityId, linkedAccountId, url, format, parserKey, lastSyncAt",
				"NE PAS créer les tables legacy inutilisées: NetWorthSnapshot, RecurringExpense, LoanSchedule, positions, investment_orders, price_history",
				"Schéma final avec ~18 tables essentielles uniquement",
				"npx prisma validate passe",
				"npx prisma format appliqué",
				"npm run lint passe",
				"npx tsc --noEmit passe"
			],
			"files": ["prisma/schema.prisma"],
			"dependsOn": ["US-011", "US-012", "US-013"],
			"priority": 6,
			"passes": false,
			"notes": "Tables essentielles: users, owners, banks, accounts, transactions, categories, category_rules, transaction_categories, entities, entity_shares, re_properties, property_ownership, re_loans, loan_responsibility, property_charges, data_sources, investment_sources, investment_positions, investment_transactions"
		},
		{
			"id": "US-015",
			"title": "Migration initiale Prisma",
			"description": "En tant que développeur, je veux générer et appliquer la migration initiale",
			"acceptanceCriteria": [
				"npx prisma migrate dev --name init crée la migration",
				"Tables créées dans Supabase",
				"npx prisma db push fonctionne",
				"Script prisma/seed.ts créé avec données de base (entities, categories)",
				"package.json contient prisma.seed config",
				"npx prisma db seed fonctionne"
			],
			"files": ["prisma/migrations/", "prisma/seed.ts", "package.json"],
			"dependsOn": ["US-014"],
			"priority": 7,
			"passes": false,
			"notes": "Seed: Mathieu, Ninon, Isaac, SCI IMANISA + catégories de base"
		},
		{
			"id": "US-020",
			"title": "Copie Domain Layer",
			"description": "En tant que développeur, je veux copier la couche domaine existante",
			"acceptanceCriteria": [
				"Copier src/domain/ intégralement",
				"Mettre à jour les imports (paths aliases)",
				"Supprimer dépendances Svelte si présentes",
				"TypeScript compile sans erreur",
				"Entities, Value Objects, interfaces Repository conservés"
			],
			"files": ["src/domain/"],
			"dependsOn": ["US-001"],
			"priority": 4,
			"passes": false,
			"notes": "La clean architecture permet réutilisation quasi-totale du domain"
		},
		{
			"id": "US-021",
			"title": "Repositories Prisma - Core",
			"description": "En tant que développeur, je veux adapter les repositories core pour Prisma",
			"acceptanceCriteria": [
				"src/infrastructure/repositories/AccountRepository.ts avec Prisma",
				"src/infrastructure/repositories/BankRepository.ts avec Prisma",
				"src/infrastructure/repositories/TransactionRepository.ts avec Prisma",
				"Gestion des signes: expense = negative, income = positive",
				"Méthodes: findById, findByBankId, findByDateRange, save, saveMany, delete"
			],
			"files": ["src/infrastructure/repositories/"],
			"dependsOn": ["US-015", "US-020"],
			"priority": 8,
			"passes": false,
			"notes": "Convertir Drizzle queries → Prisma queries. prisma.transaction.findMany etc."
		},
		{
			"id": "US-022",
			"title": "Repositories Prisma - Budget",
			"description": "En tant que développeur, je veux adapter les repositories budget pour Prisma",
			"acceptanceCriteria": [
				"src/infrastructure/repositories/CategoryRepository.ts",
				"Méthodes: findAll, findById, findByParentId, findWithChildren, save, delete",
				"Gestion hiérarchie parent/children avec include",
				"TransactionCategory repository intégré"
			],
			"files": ["src/infrastructure/repositories/"],
			"dependsOn": ["US-015", "US-020"],
			"priority": 8,
			"passes": false,
			"notes": "Prisma gère bien les self-references avec include: { children: true }"
		},
		{
			"id": "US-023",
			"title": "Repositories Prisma - Immobilier",
			"description": "En tant que développeur, je veux adapter les repositories immobilier pour Prisma",
			"acceptanceCriteria": [
				"src/infrastructure/repositories/PropertyRepository.ts",
				"src/infrastructure/repositories/EntityRepository.ts",
				"src/infrastructure/repositories/LoanRepository.ts",
				"Include nested: property.ownerships.entity, property.loan.responsibilities",
				"Calculs agrégés: total value, total debt, net equity"
			],
			"files": ["src/infrastructure/repositories/"],
			"dependsOn": ["US-015", "US-020"],
			"priority": 8,
			"passes": false,
			"notes": "Relations complexes avec ownership partagé"
		},
		{
			"id": "US-024",
			"title": "Repositories Prisma - Investissements",
			"description": "En tant que développeur, je veux adapter les repositories investissements pour Prisma",
			"acceptanceCriteria": [
				"src/infrastructure/repositories/InvestmentSourceRepository.ts",
				"src/infrastructure/repositories/InvestmentPositionRepository.ts",
				"Méthodes: findAll, findBySource, upsertPositions, calculateSummary",
				"Calculs: total invested, current value, total gain/loss"
			],
			"files": ["src/infrastructure/repositories/"],
			"dependsOn": ["US-015", "US-020"],
			"priority": 8,
			"passes": false,
			"notes": "Upsert pour remplacer positions lors d'un import"
		},
		{
			"id": "US-030",
			"title": "Configuration Auth Google OAuth + Whitelist",
			"description": "En tant que développeur, je veux configurer l'authentification Google avec whitelist stricte",
			"acceptanceCriteria": [
				"npm install better-auth @better-auth/google",
				"Créer projet Google Cloud Console + OAuth credentials",
				"src/lib/auth.ts avec Better Auth + Google provider",
				"WHITELIST dans .env: ALLOWED_EMAILS=mathieu@email.com,ninon@email.com",
				"Callback signIn vérifie email dans whitelist, sinon reject avec message",
				"Session cookies sécurisés (httpOnly, secure, sameSite)",
				"app/api/auth/[...all]/route.ts handler",
				"middleware.ts protège toutes routes sauf /login et /api/auth/*",
				"Test: email non-whitelisté = erreur 'Accès non autorisé'"
			],
			"files": [
				"src/lib/auth.ts",
				"app/api/auth/[...all]/route.ts",
				"middleware.ts",
				".env.example"
			],
			"dependsOn": ["US-003"],
			"priority": 4,
			"passes": false,
			"notes": "SÉCURITÉ CRITIQUE: Seuls 2 emails Google autorisés. Variables: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, ALLOWED_EMAILS"
		},
		{
			"id": "US-031",
			"title": "Page Login Google",
			"description": "En tant qu'utilisateur autorisé, je veux me connecter avec mon compte Google",
			"acceptanceCriteria": [
				"app/(auth)/login/page.tsx avec bouton 'Se connecter avec Google'",
				"app/(auth)/layout.tsx layout centré avec design liquid glass",
				"Logo Imanisa Finance + tagline",
				"Bouton Google avec icône SVG officielle",
				"Message d'erreur si email non autorisé: 'Ce compte n'est pas autorisé'",
				"Redirection vers / après login réussi",
				"Animation de chargement pendant auth"
			],
			"files": ["app/(auth)/login/page.tsx", "app/(auth)/layout.tsx"],
			"dependsOn": ["US-002", "US-030"],
			"priority": 9,
			"passes": false,
			"notes": "Design épuré, un seul bouton Google. Pas de formulaire email/password."
		},
		{
			"id": "US-040",
			"title": "Layout Dashboard + Navigation",
			"description": "En tant qu'utilisateur, je veux naviguer dans l'application",
			"acceptanceCriteria": [
				"app/(dashboard)/layout.tsx avec sidebar desktop + bottom nav mobile",
				"src/components/navigation.tsx avec liens: Dashboard, Comptes, Budget, Investissements, Immobilier, Crédits, Import",
				"src/components/theme-toggle.tsx pour dark/light mode",
				"User menu avec logout",
				"Responsive: Sheet mobile, Sidebar desktop",
				"Active link highlighted"
			],
			"files": [
				"app/(dashboard)/layout.tsx",
				"src/components/navigation.tsx",
				"src/components/theme-toggle.tsx"
			],
			"dependsOn": ["US-002", "US-030"],
			"priority": 9,
			"passes": false,
			"notes": "Icons: lucide-react. Glass effect optionnel."
		},
		{
			"id": "US-050",
			"title": "Page Dashboard - KPIs",
			"description": "En tant qu'utilisateur, je veux voir un résumé de ma situation financière",
			"acceptanceCriteria": [
				"app/(dashboard)/page.tsx créé",
				"Card Patrimoine Net Total (calculé)",
				"Card Liquidités (somme comptes courants)",
				"Card Investissements (total positions)",
				"Card Immobilier (valeur - dettes)",
				"Données via Server Component + repositories",
				"Skeleton loading states",
				"npm run lint && npm run build && npx tsc --noEmit passent"
			],
			"files": ["app/(dashboard)/page.tsx"],
			"dependsOn": ["US-021", "US-023", "US-024", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Server Component pour data fetching. Cards shadcn."
		},
		{
			"id": "US-051",
			"title": "Page Dashboard - Charts",
			"description": "En tant qu'utilisateur, je veux voir l'évolution de mon patrimoine",
			"acceptanceCriteria": [
				"Installer recharts",
				"Chart Line: évolution patrimoine sur 12 mois",
				"Chart Pie: répartition actifs (liquide, investi, immo)",
				"Composants src/components/charts/",
				"Responsive et accessible"
			],
			"files": ["app/(dashboard)/page.tsx", "src/components/charts/"],
			"dependsOn": ["US-050"],
			"priority": 11,
			"passes": false,
			"notes": "shadcn/ui a des composants chart intégrés"
		},
		{
			"id": "US-060",
			"title": "Page Comptes",
			"description": "En tant qu'utilisateur, je veux voir mes comptes bancaires",
			"acceptanceCriteria": [
				"app/(dashboard)/accounts/page.tsx",
				"Liste comptes groupés par banque",
				"Solde par compte avec badge couleur",
				"Total par banque",
				"Lien vers transactions du compte",
				"Card par banque, liste de comptes dedans"
			],
			"files": ["app/(dashboard)/accounts/page.tsx"],
			"dependsOn": ["US-021", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Utiliser Accordion ou Collapsible pour grouper par banque"
		},
		{
			"id": "US-061",
			"title": "Page Transactions",
			"description": "En tant qu'utilisateur, je veux voir et filtrer mes transactions",
			"acceptanceCriteria": [
				"app/(dashboard)/transactions/page.tsx",
				"DataTable avec TanStack Table + shadcn",
				"Colonnes: Date, Description, Montant, Catégorie, Compte",
				"Filtres: compte (select), période (date range), catégorie (select)",
				"Recherche par description",
				"Pagination serveur-side",
				"Export CSV optionnel"
			],
			"files": ["app/(dashboard)/transactions/page.tsx", "src/components/transactions-table.tsx"],
			"dependsOn": ["US-021", "US-022", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "TanStack Table v8 avec shadcn DataTable pattern"
		},
		{
			"id": "US-062",
			"title": "Catégorisation manuelle transactions",
			"description": "En tant qu'utilisateur, je veux catégoriser manuellement une transaction",
			"acceptanceCriteria": [
				"Dropdown catégorie sur chaque ligne transaction",
				"Command (searchable) avec liste hiérarchique catégories",
				"Server Action src/actions/transactions.ts setCategoryAction",
				"Optimistic update UI",
				"Badge couleur selon source (bank/auto/manual)"
			],
			"files": ["app/(dashboard)/transactions/page.tsx", "src/actions/transactions.ts"],
			"dependsOn": ["US-061"],
			"priority": 11,
			"passes": false,
			"notes": "Utiliser Command de shadcn pour recherche catégorie"
		},
		{
			"id": "US-070",
			"title": "Page Budget - Vue catégories",
			"description": "En tant qu'utilisateur, je veux voir mes dépenses par catégorie",
			"acceptanceCriteria": [
				"app/(dashboard)/budget/page.tsx",
				"Select période: Ce mois, Mois dernier, Trimestre, Année",
				"Total Dépenses, Total Revenus, Solde Net",
				"Liste catégories parentes avec montant et %",
				"Exclusion virements internes (category 'Transaction exclue')",
				"Clic catégorie → expand sous-catégories"
			],
			"files": ["app/(dashboard)/budget/page.tsx"],
			"dependsOn": ["US-022", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Réutiliser logique budget/+page.server.ts de SvelteKit"
		},
		{
			"id": "US-071",
			"title": "Page Budget - Charts",
			"description": "En tant qu'utilisateur, je veux voir des graphiques budget",
			"acceptanceCriteria": [
				"Chart Donut: dépenses par catégorie",
				"Chart Bar: revenus vs dépenses par mois",
				"Légende interactive (clic cache/montre)",
				"Couleurs par catégorie"
			],
			"files": ["app/(dashboard)/budget/page.tsx"],
			"dependsOn": ["US-070"],
			"priority": 11,
			"passes": false,
			"notes": "Recharts PieChart et BarChart"
		},
		{
			"id": "US-072",
			"title": "Page Règles catégorisation",
			"description": "En tant qu'utilisateur, je veux gérer les règles de catégorisation",
			"acceptanceCriteria": [
				"app/(dashboard)/budget/rules/page.tsx",
				"Table des règles: pattern, catégorie, priorité, actif",
				"Dialog création: pattern (input), catégorie (select), priorité (number)",
				"Bouton Tester: preview transactions matchées",
				"Bouton Appliquer: recatégorise les transactions",
				"Bouton Supprimer avec confirmation"
			],
			"files": ["app/(dashboard)/budget/rules/page.tsx", "src/actions/category-rules.ts"],
			"dependsOn": ["US-022", "US-040"],
			"priority": 11,
			"passes": false,
			"notes": "Dialog shadcn pour création/édition"
		},
		{
			"id": "US-080",
			"title": "Page Investissements - Portfolio",
			"description": "En tant qu'utilisateur, je veux voir mon portefeuille d'investissements",
			"acceptanceCriteria": [
				"app/(dashboard)/investments/page.tsx",
				"KPIs: Total Investi, Valorisation, +/- Value (€ et %)",
				"Positions groupées par source (PEA, AV, Crypto)",
				"Par position: symbol, quantité, PRU, cours, valeur, +/- value",
				"Couleur: vert gain, rouge perte",
				"Bouton Refresh prix"
			],
			"files": ["app/(dashboard)/investments/page.tsx"],
			"dependsOn": ["US-024", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Accordion par source. Badge gain/perte coloré."
		},
		{
			"id": "US-081",
			"title": "API Refresh Prix",
			"description": "En tant qu'utilisateur, je veux mettre à jour les prix de mes investissements",
			"acceptanceCriteria": [
				"app/api/prices/route.ts",
				"GET: refresh tous les prix",
				"Intégration Yahoo Finance pour actions/ETF",
				"Intégration CoinGecko pour crypto",
				"Mise à jour currentPrice et recalcul gainLoss",
				"Retourne { updated: number, errors: string[] }"
			],
			"files": ["app/api/prices/route.ts", "src/services/price-fetcher.ts"],
			"dependsOn": ["US-024"],
			"priority": 11,
			"passes": false,
			"notes": "Copier logique existante api/prices/+server.ts"
		},
		{
			"id": "US-090",
			"title": "Page Immobilier - Liste biens",
			"description": "En tant qu'utilisateur, je veux voir mon patrimoine immobilier",
			"acceptanceCriteria": [
				"app/(dashboard)/immobilier/page.tsx",
				"KPIs: Valeur totale, Dette totale, Equity nette",
				"Cards par propriété: nom, adresse, surface, DPE, valeur, CRD prêt",
				"Affichage propriétaires avec badge couleur",
				"Lien vers détail /immobilier/[id]"
			],
			"files": ["app/(dashboard)/immobilier/page.tsx"],
			"dependsOn": ["US-023", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Badge DPE avec couleur (A=vert, G=rouge)"
		},
		{
			"id": "US-091",
			"title": "Page Immobilier - Détail bien",
			"description": "En tant qu'utilisateur, je veux voir le détail d'un bien",
			"acceptanceCriteria": [
				"app/(dashboard)/immobilier/[id]/page.tsx",
				"Section Info: adresse complète, surface, pièces, étage, DPE, copropriété",
				"Section Valeur: achat, frais, valeur actuelle, +/- value",
				"Section Prêt: banque, taux, mensualité, CRD, date fin",
				"Section Propriété: propriétaires avec % et type acquisition",
				"Section Charges: liste charges annuelles",
				"Bouton retour"
			],
			"files": ["app/(dashboard)/immobilier/[id]/page.tsx"],
			"dependsOn": ["US-090"],
			"priority": 11,
			"passes": false,
			"notes": "Tabs ou Sections collapsibles sur mobile"
		},
		{
			"id": "US-092",
			"title": "Tableau amortissement prêt",
			"description": "En tant qu'utilisateur, je veux voir le tableau d'amortissement de mon prêt",
			"acceptanceCriteria": [
				"Composant src/components/amortization-table.tsx",
				"Colonnes: Date, Mensualité, Capital, Intérêts, Assurance, Restant",
				"Highlight mois actuel",
				"Scroll horizontal sur mobile avec sticky first column",
				"Intégré dans page détail bien"
			],
			"files": [
				"src/components/amortization-table.tsx",
				"app/(dashboard)/immobilier/[id]/page.tsx"
			],
			"dependsOn": ["US-091"],
			"priority": 12,
			"passes": false,
			"notes": "Réutiliser loan-calculator.ts existant"
		},
		{
			"id": "US-100",
			"title": "Page Crédits",
			"description": "En tant qu'utilisateur, je veux voir tous mes crédits",
			"acceptanceCriteria": [
				"app/(dashboard)/loans/page.tsx",
				"Total dette tous prêts",
				"Liste prêts: nom, banque, CRD, mensualité, taux, date fin",
				"Progress bar: remboursé vs restant",
				"Groupement par propriété (si lié) ou 'Autres'"
			],
			"files": ["app/(dashboard)/loans/page.tsx"],
			"dependsOn": ["US-023", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "Inclure reLoans et legacyLoans"
		},
		{
			"id": "US-110",
			"title": "Page Import - UI",
			"description": "En tant qu'utilisateur, je veux importer mes relevés bancaires",
			"acceptanceCriteria": [
				"app/(dashboard)/import/page.tsx",
				"Liste sources groupées par propriétaire",
				"Par source: nom, type, dernière sync, zone drop",
				"Bouton 'Ouvrir tous les liens' → window.open chaque URL",
				"Drag & drop fichier sur zone → upload",
				"Affichage résultat: X importées, Y ignorées, erreurs"
			],
			"files": ["app/(dashboard)/import/page.tsx"],
			"dependsOn": ["US-021", "US-040"],
			"priority": 10,
			"passes": false,
			"notes": "react-dropzone pour drag & drop"
		},
		{
			"id": "US-111",
			"title": "API Import CSV",
			"description": "En tant que développeur, je veux traiter l'upload CSV",
			"acceptanceCriteria": [
				"app/api/import/csv/route.ts",
				"POST avec FormData: file + dataSourceId",
				"Sélection parser selon dataSource.parserKey",
				"Parse → dédupe → insert transactions",
				"Auto-catégorisation après insert",
				"Retourne { imported, skipped, categorized, errors }"
			],
			"files": ["app/api/import/csv/route.ts", "src/services/csv-import.ts"],
			"dependsOn": ["US-021"],
			"priority": 11,
			"passes": false,
			"notes": "Copier parsers existants: CaisseEpargneParser, CreditMutuelParser, BoursoramaParser"
		},
		{
			"id": "US-112",
			"title": "Copie Parsers CSV/XLSX",
			"description": "En tant que développeur, je veux réutiliser les parsers existants",
			"acceptanceCriteria": [
				"Copier src/infrastructure/parsers/ intégralement",
				"CaisseEpargneParser, CreditMutuelParser, BoursoramaParser",
				"BourseDirectParser, LinxeaParser, BinanceParser",
				"ParserFactory pour instanciation",
				"Types adaptés si nécessaire"
			],
			"files": ["src/infrastructure/parsers/"],
			"dependsOn": ["US-020"],
			"priority": 8,
			"passes": false,
			"notes": "Parsers sont indépendants du framework, réutilisation directe"
		},
		{
			"id": "US-130",
			"title": "Configuration Vercel",
			"description": "En tant que développeur, je veux déployer sur Vercel",
			"acceptanceCriteria": [
				"vercel.json si nécessaire",
				".env.production.local avec vraies variables",
				"Variables d'environnement configurées dans Vercel dashboard",
				"npm run build passe",
				"Déploiement preview fonctionnel",
				"Connexion Supabase fonctionne"
			],
			"files": ["vercel.json", ".env.production"],
			"dependsOn": ["US-015"],
			"priority": 13,
			"passes": false,
			"notes": "Hobby plan gratuit. DATABASE_URL, AUTH_SECRET à configurer."
		},
		{
			"id": "US-125",
			"title": "CI/CD GitHub Actions + Codecov",
			"description": "En tant que développeur, je veux une pipeline CI/CD complète",
			"acceptanceCriteria": [
				"Créer .github/workflows/ci.yml",
				"Job 'lint': npm run check (Biome)",
				"Job 'typecheck': npx tsc --noEmit",
				"Job 'test-unit': npm run test -- --coverage (Vitest)",
				"Job 'test-integration': npm run test:integration (Testcontainers, needs Docker)",
				"Upload coverage vers Codecov avec codecov/codecov-action@v4",
				"Créer codecov.yml avec target coverage 80%",
				"Job 'build': npm run build",
				"Job 'e2e': npm run test:e2e (Playwright) - only on main/PR",
				"Vercel auto-deploy configuré sur push main + preview sur PR",
				"Badge Codecov dans README.md",
				"Tous les jobs passent sur une PR test"
			],
			"files": [".github/workflows/ci.yml", "codecov.yml", "README.md"],
			"dependsOn": ["US-002C"],
			"priority": 12,
			"passes": false,
			"notes": "Vercel s'intègre automatiquement via GitHub. Codecov gratuit pour projets publics."
		},
		{
			"id": "US-140",
			"title": "Tests Domain Layer (90%+ coverage)",
			"description": "En tant que développeur, je veux des tests unitaires exhaustifs sur la couche domaine",
			"acceptanceCriteria": [
				"Tests pour toutes les entités: Account, Transaction, Category, Property, Loan, InvestmentPosition",
				"Tests pour tous les Value Objects: Money, UniqueId, Result",
				"Tests pour les enums et leurs validations",
				"Tests des cas nominaux ET cas d'erreur (edge cases, validation)",
				"Coverage domaine >= 90% (vérifié par Codecov)",
				"Chaque test utilise des assertions claires",
				"npm run test -- --coverage montre >= 90% sur src/domain/"
			],
			"files": ["src/domain/**/*.test.ts"],
			"dependsOn": ["US-020", "US-002C"],
			"priority": 13,
			"passes": false,
			"notes": "Le domaine est le cœur métier - doit être testé au maximum. Pure unit tests, pas de mocks externes."
		},
		{
			"id": "US-141",
			"title": "Tests Intégration API (ts-rest + Testcontainers)",
			"description": "En tant que développeur, je veux des tests d'intégration pour les routes API",
			"acceptanceCriteria": [
				"Tests pour chaque endpoint ts-rest: accounts, transactions, budget, investments, properties",
				"Utiliser Testcontainers pour vraie DB PostgreSQL",
				"Tester CRUD complet: create, read, update, delete",
				"Tester les cas d'erreur: 404, 400 validation, 401 unauthorized",
				"Tester les queries complexes: filtres, pagination, agrégations",
				"MSW pour mocker services externes (Yahoo Finance, CoinGecko)",
				"npm run test:integration passe"
			],
			"files": ["src/tests/integration/api/"],
			"dependsOn": ["US-002D", "US-021", "US-022", "US-023", "US-024"],
			"priority": 13,
			"passes": false,
			"notes": "Tests d'intégration = vraie DB, vrais repositories, mocked external services"
		},
		{
			"id": "US-142",
			"title": "Tests Composants React (Testing Library)",
			"description": "En tant que développeur, je veux des tests pour les composants UI critiques",
			"acceptanceCriteria": [
				"Tests pour Navigation: rendu, liens actifs, responsive",
				"Tests pour KPI Cards: affichage montants, formatage, couleurs gain/perte",
				"Tests pour DataTable transactions: tri, filtres, pagination",
				"Tests pour CategoryBadge: couleurs selon source, dropdown",
				"Tests pour AmortizationTable: calculs, highlight mois actuel",
				"Tests accessibilité: aria-labels, keyboard navigation",
				"Utiliser @testing-library/react + @testing-library/user-event",
				"npm run test passe"
			],
			"files": ["src/components/**/*.test.tsx"],
			"dependsOn": ["US-002C", "US-040", "US-050", "US-061"],
			"priority": 13,
			"passes": false,
			"notes": "Focus sur composants critiques et interactifs. Pas besoin de tester chaque bouton."
		},
		{
			"id": "US-143",
			"title": "Tests E2E Playwright (parcours utilisateur)",
			"description": "En tant que développeur, je veux des tests E2E pour valider les parcours complets",
			"acceptanceCriteria": [
				"npm install -D @playwright/test && npx playwright install",
				"playwright.config.ts avec webServer auto-start",
				"e2e/auth.spec.ts: login Google (mock), redirect dashboard, logout",
				"e2e/dashboard.spec.ts: KPIs affichés, navigation entre pages",
				"e2e/import.spec.ts: upload CSV, vérifier transactions importées",
				"e2e/budget.spec.ts: changer période, voir catégories, catégoriser transaction",
				"e2e/investments.spec.ts: voir positions, refresh prix",
				"e2e/immobilier.spec.ts: liste biens, détail, tableau amortissement",
				"Tests sur viewport mobile (375px) et desktop (1280px)",
				"npm run test:e2e passe (tous les tests)"
			],
			"files": ["playwright.config.ts", "e2e/"],
			"dependsOn": ["US-125", "US-130"],
			"priority": 14,
			"passes": false,
			"notes": "E2E = validation finale bout-en-bout. Mocker l'auth Google pour les tests."
		}
	]
}
